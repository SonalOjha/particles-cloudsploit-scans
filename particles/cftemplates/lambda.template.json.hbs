{{#layout}}

  {{
    parameter "module:particles-common-core" "base"
    type="String"
    logicalId="ExecutionRole"
    default=""
    description="[optional] If no role is provided one will be created with a minimal policy statement for CloudSploit to run within the deployed to account"
  }}
  {{condition "module:particles-common-core" "is_empty" logicalId="ExecutionRoleIsEmpty" parameterLogicalId="ExecutionRole"}}

  {{
    resource "module:particles-common-core" "base"
    logicalId="LambdaExecutionRole"
    type="AWS::IAM::Role"
    condition="ExecutionRoleIsEmpty"
    properties=(partial "lambda_execution_role_properties")
  }}

  {{
    resource "module:particles-common-core" "base"
    logicalId='Lambda'
    type="AWS::Lambda::Function"
    properties=(
      partial "lambda_properties"
      rolePropertyValue=(partial "lambda_role_property_if")
    )
  }}
  "Role": {{partial "module:particles-common-core" "fn_get_att" logicalId=roleLogicalId attributeName="Arn" }},

  {{
    output 'module:particles-common-core' 'base'
    logicalId="LambdaName"
    value=(partial 'module:particles-common-core' 'ref' logicalId='Lambda')
    description="Name of the Lambda function"
  }}

  {{
    output 'module:particles-common-core' 'base'
    logicalId="LambdaArn"
    value=(partial 'module:particles-common-core' 'fn_get_att' logicalId='Lambda' attributeName="Arn")
    description="ARN of the Lambda function"
  }}

  {{
    output 'module:particles-common-core' 'base'
    logicalId="LambdaName"
    value=(partial 'module:particles-common-core' 'ref' logicalId='LambdaExecutionRole')
    description="Name of the Execution Role"
  }}

  {{
    output 'module:particles-common-core' 'base'
    logicalId="RoleArn"
    value=(partial 'module:particles-common-core' 'fn_get_att' logicalId='LambdaExecutionRole' attributeName="Arn")
    description="ARN of the Execution Role"
  }}

{{/layout}}
